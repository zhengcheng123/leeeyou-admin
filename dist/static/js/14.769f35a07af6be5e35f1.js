webpackJsonp([14],{"/dkg":function(e,t,o){t=e.exports=o("FZ+f")(!1),t.push([e.i,".coupon-add[data-v-ee488746]{border-radius:3px;background-color:#fff;width:100%}.section-head[data-v-ee488746]{width:auto;position:relative;background-color:#f5f7fb;font-weight:600;height:40px;line-height:40px;padding-left:48px;margin-bottom:10px}[data-v-ee488746] .el-input--small .el-input__inner{width:210px}.el-input-group__append[data-v-ee488746],[data-v-ee488746] .el-form-item__content .el-input-group,[data-v-ee488746] .el-input-group--prepend .el-input__inner{width:200px}[data-v-ee488746] .input-with-select .el-input-group__prepend{background-color:#fff}.footer[data-v-ee488746]{text-align:center;height:65px}",""])},"2ZdO":function(e,t,o){"use strict";var s=o("Dd8w"),a=o.n(s),r=o("fZjL"),i=o.n(r);t.a={data:function(){return{available:"1",expire:"",checkId:[],itemId:[],typeId:[],dateRange:"1",distributeUserLimites:"1",currentItems:[],storItems:[],commonTypes:[],distributeGoodsBaseObject:{goodsCommonId:"",goodsId:"",goodsName:"",goodsState:"",id:"",templateId:""},useGoodsBaseObject:{goodsCommonId:0,goodsId:0,goodsName:"",goodsState:0,goodsType:0,id:0,templateId:0},couponPassForm:{category:"1",code:"",count:"",createTime:"",discountBase:null,discountQuota:"",distributeBase:null,distributeCount:"",distributeDayLimite:void 0,distributeEnd:"",distributeGoods:[],distributeArr:[],expireArr:[],distributeType:"1",distributeUserLimite:void 0,expireCount:"",expireEnd:"",expireGap:"",expirePeriod:"",expireStart:"",expired:!0,id:"",intro:"",logo:"",name:"",productline:"",storeId:0,useCount:0,useGoods:[],useType:"",userId:0,weight:0},rules:{category:[{required:!0,message:"请选择",trigger:"blur"}],count:[{required:!0,message:"请输入",trigger:"blur"}],discountQuota:[{required:!0,message:"请输入",trigger:"blur"}],distributeBase:[{required:!0,message:"请输入",trigger:"blur"}],distributeArr:[{required:!0,message:"请输入",trigger:"blur"}],distributeType:[{required:!0,message:"请输入",trigger:"blur"}],distributeUserLimite:[{required:!0,message:"请输入",trigger:"blur"}],expirePeriod:[{required:!0,message:"请输入",trigger:"blur"}],name:[{required:!0,message:"请输入",trigger:"blur"}],useType:[{required:!0,message:"请输入",trigger:"blur"}]},conditionForm:{condition:{name:"",type:null,state:"",recommend:""},page:{pageSize:15,pageNum:1,total:0,sortname:"id",sortorder:"desc"}},params:{condition:{name:"",type:null,state:"",recommend:""},page:{pageSize:15,pageNum:1,total:0,sortname:"id",sortorder:"desc"}},Id:this.$route.query.id,pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},mounted:function(){this.getGrands(),this.getDetial()},methods:{getGrands:function(){var e=this;this.$axios.get(globalConfig.server1+"api/goodsType/getTypesByLevel/2").then(function(t){1===t.data.result?e.commonTypes=t.data.object:console.error("获取商品分类失败")})},getDetial:function(){var e=this;this.$axios.get(globalConfig.server1+"couponTemplate/get/"+this.Id).then(function(t){1===t.data.result?(e.couponPassForm=t.data.object,e.couponPassForm.distributeBase=e.couponPassForm.distributeBase/100,e.couponPassForm.discountQuota=e.couponPassForm.discountQuota/100,e.couponPassForm.discountBase=e.couponPassForm.discountBase/100,e.couponPassForm.expirePeriod=e.couponPassForm.expirePeriod+"",e.couponPassForm.category=e.couponPassForm.category+"",e.couponPassForm.distributeArr=[t.data.object.distributeStart,t.data.object.distributeEnd],e.couponPassForm.expireArr=[t.data.object.expireStart,t.data.object.expireEnd],0===t.data.object.discountBase?e.expire="1":e.expire="2",e.getItems(1),e.getItems(2)):console.error("res.data.rbg")})},getItems:function(e){var t=this;this.$axios.post(globalConfig.server1+"api/goods/list",this.conditionForm).then(function(o){if(1===o.data.result){if(o.list<=0)return t.$message({message:"没有找到匹配项",type:"info"}),!1;if(1==e){t.currentItems=o.data.list,t.conditionForm.page.total=o.data.page.total,t.couponPassForm.useType=t.couponPassForm.useType+"",t.couponPassForm.distributeType=t.couponPassForm.distributeType+"";var s=t.couponPassForm.distributeGoods;s&&s.length>0&&t.$nextTick(function(){t.currentItems.forEach(function(e){s.filter(function(t){return e.id==t.goodsCommonId}).length>0&&t.$refs.multipleCurrentItems.toggleRowSelection(e,!0)})})}else if(2==e){t.storItems=o.data.list,t.params.page.total=o.data.page.total;var a=t.couponPassForm.useGoods,r=t.couponPassForm.useGoods;t.$nextTick(function(){a&&a.length>0&&t.storItems.forEach(function(e){a.filter(function(t){return e.id==t.goodsCommonId}).length>0&&t.$refs.multipleStorItems.toggleRowSelection(e,!0)}),t.commonTypes.forEach(function(e){r.filter(function(t){return e.id==t.goodsType}).length>0&&t.$refs.typeStorItems.toggleRowSelection(e,!0)})})}}else t.$message({message:"获取入库列表失败",type:"error"}),t.currentItems=[],t.storItems=[],t.commonTypes=[]})},getNewObject:function(e,t,o,s){var a=i()(e);return s.map(function(s){var r={};a.forEach(function(t){r[t]=e[t]});for(var i=0;i<t.length;i++)r[o[i]]=s[t[i]];return r})},addSure:function(){var e=this;this.checkId.length>0&&(this.couponPassForm.distributeGoods=this.getNewObject(this.distributeGoodsBaseObject,["id"],["goodsCommonId"],this.checkId)),this.itemId.length>0&&(this.couponPassForm.useGoods=this.getNewObject(this.useGoodsBaseObject,["id"],["goodsCommonId"],this.itemId)),this.typeId.length>0&&(this.couponPassForm.useGoods=this.getNewObject(this.useGoodsBaseObject,["id"],["goodsType"],this.typeId));var t=a()({},this.couponPassForm,{distributeStart:this.couponPassForm.distributeArr[0],distributeEnd:this.couponPassForm.distributeArr[1],expireStart:this.couponPassForm.expireArr[0],expireEnd:this.couponPassForm.expireArr[1]});"1"===this.expire&&(t.discountBase=0),t.discountQuota=100*this.couponPassForm.discountQuota,t.distributeBase=100*this.couponPassForm.distributeBase,t.discountBase=100*this.couponPassForm.discountBase,this.$axios.post(globalConfig.server1+"couponTemplate/update",t).then(function(t){1===t.data.result?(e.$message.success(t.data.msg),e.$router.go(-1)):e.$message.error(t.data.msg)})},handleSelectionChange:function(e){this.checkId=e},storeChange:function(e){this.itemId=e},typeChange:function(e){this.typeId=e},pageSize:function(e,t){this.conditionForm.page.pageSize=e,this.getItems(t)},pageNo:function(e,t){this.conditionForm.page.pageNum=e,this.getItems(t)},inputChange:function(e,t){var o=""+e;o&&(o=o.replace(/[^\d.]/g,""),o=o.replace(/\.{2,}/g,"."),o=o.replace(".","$#$").replace(/\./g,"").replace("$#$","."),o=o.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),o.indexOf(".")<0&&""!=o&&(o=parseFloat(o)),this.couponPassForm[t]=o)},backList:function(){this.$router.go(-1)}}}},Cdx3:function(e,t,o){var s=o("sB3e"),a=o("lktj");o("uqUo")("keys",function(){return function(e){return a(s(e))}})},cU57:function(e,t,o){"use strict";var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"coupon-add"},[o("div",{staticClass:"section-head"},[e._v("基础信息")]),e._v(" "),o("el-form",{ref:"couponPassForm",attrs:{model:e.couponPassForm,rules:e.rules,"label-width":"81px"}},[o("el-form-item",{attrs:{label:"优惠券类型：",prop:"category","label-width":"150px"}},[o("el-select",{attrs:{clearable:""},model:{value:e.couponPassForm.category,callback:function(t){e.$set(e.couponPassForm,"category",t)},expression:"couponPassForm.category"}},[o("el-option",{attrs:{label:"购物赠券",value:"1"}}),e._v(" "),o("el-option",{attrs:{label:"全场赠券",value:"2"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"优惠券名称：",prop:"name","label-width":"150px"}},[o("el-input",{attrs:{size:"small"},model:{value:e.couponPassForm.name,callback:function(t){e.$set(e.couponPassForm,"name",t)},expression:"couponPassForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"总发放量：",prop:"count","label-width":"150px"}},[o("el-input",{attrs:{size:"small"},nativeOn:{keyup:function(t){return e.inputChange(e.couponPassForm.count,"count")}},model:{value:e.couponPassForm.count,callback:function(t){e.$set(e.couponPassForm,"count",t)},expression:"couponPassForm.count"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"面额：",prop:"discountQuota","label-width":"150px"}},[o("el-input",{attrs:{size:"small"},nativeOn:{keyup:function(t){return e.inputChange(e.couponPassForm.discountQuota,"discountQuota")}},model:{value:e.couponPassForm.discountQuota,callback:function(t){e.$set(e.couponPassForm,"discountQuota",t)},expression:"couponPassForm.discountQuota"}},[o("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),o("el-form-item",{attrs:{label:"每人限领：",prop:"distributeUserLimites","label-width":"150px"}},[[o("el-radio-group",{model:{value:e.distributeUserLimites,callback:function(t){e.distributeUserLimites=t},expression:"distributeUserLimites"}},[o("el-radio",{attrs:{label:"1"}},[e._v("\n              每人限领  \n              "),o("el-input-number",{attrs:{label:"描述文字"},model:{value:e.couponPassForm.distributeUserLimite,callback:function(t){e.$set(e.couponPassForm,"distributeUserLimite",t)},expression:"couponPassForm.distributeUserLimite"}}),e._v("  张\n            ")],1),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("\n              每人每日限领  \n              "),o("el-input-number",{attrs:{label:"描述文字"},model:{value:e.couponPassForm.distributeDayLimite,callback:function(t){e.$set(e.couponPassForm,"distributeDayLimite",t)},expression:"couponPassForm.distributeDayLimite"}}),e._v("  张\n            ")],1)],1)]],2),e._v(" "),o("div",{staticClass:"section-head"},[e._v("发放规则")]),e._v(" "),o("el-form-item",{attrs:{label:"发放时间：",prop:"useType","label-width":"150px"}},[o("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.couponPassForm.distributeArr,callback:function(t){e.$set(e.couponPassForm,"distributeArr",t)},expression:"couponPassForm.distributeArr"}})],1),e._v(" "),"1"===e.couponPassForm.category?o("div",[o("el-form-item",{attrs:{label:"发放方式：",prop:"distributeType","label-width":"150px"}},[[o("el-radio-group",{model:{value:e.couponPassForm.distributeType,callback:function(t){e.$set(e.couponPassForm,"distributeType",t)},expression:"couponPassForm.distributeType"}},[o("el-radio",{attrs:{label:"1"}},[e._v("指定商品消费")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("消费满金额发放")])],1)]],2),e._v(" "),"1"===e.couponPassForm.distributeType?o("el-form-item",{attrs:{label:"添加商品：",prop:"oldPassword","label-width":"150px"}},[o("div",{staticClass:"store-choose"},[o("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},model:{value:e.conditionForm.condition.name,callback:function(t){e.$set(e.conditionForm.condition,"name","string"==typeof t?t.trim():t)},expression:"conditionForm.condition.name"}},[o("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.conditionForm.condition.type,callback:function(t){e.$set(e.conditionForm.condition,"type",t)},expression:"conditionForm.condition.type"}},e._l(e.commonTypes,function(e){return o("el-option",{key:e.id,attrs:{label:e.typeName,value:e.id}})}),1),e._v(" "),o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.getItems(1)}},slot:"append"})],1),e._v(" "),o("el-table",{ref:"multipleCurrentItems",staticStyle:{width:"100%"},attrs:{"row-key":"id",data:e.currentItems,"tooltip-effect":"dark","header-cell-style":{background:"#E8EAEE",height:"48px"}},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{align:"center",type:"selection",width:"55","reserve-selection":!0}}),e._v(" "),o("el-table-column",{attrs:{align:"center","min-width":"100",prop:"name",label:"商品名称"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","min-width":"100",prop:"typeName",label:"商品分类"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","min-width":"120",prop:"sellStat",label:"销售状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.sellStat?o("span",[e._v("上架")]):e._e(),e._v(" "),2===t.row.sellStat?o("span",[e._v("下架")]):e._e()]}}],null,!1,2473661334)})],1),e._v(" "),o("el-pagination",{staticClass:"pagination",attrs:{"page-sizes":[15,30,50,100],"page-size":e.conditionForm.page.pageSize,"current-page":e.conditionForm.page.pageNum,layout:"total, sizes,prev, pager, next, jumper",total:e.conditionForm.page.total},on:{"size-change":function(t){return e.pageSize(t,1)},"current-change":function(t){return e.pageNo(t,1)}}})],1)]):e._e(),e._v(" "),"2"===e.couponPassForm.distributeType?o("el-form-item",{attrs:{label:"消费金额满",prop:"distributeBase","label-width":"150px"}},[o("el-input",{nativeOn:{keyup:function(t){return e.inputChange(e.couponPassForm.distributeBase,"distributeBase")}},model:{value:e.couponPassForm.distributeBase,callback:function(t){e.$set(e.couponPassForm,"distributeBase",t)},expression:"couponPassForm.distributeBase"}},[o("template",{slot:"append"},[e._v("元")])],2)],1):e._e()],1):e._e(),e._v(" "),o("div",{staticClass:"section-head"},[e._v("使用规则")]),e._v(" "),o("el-form-item",{attrs:{label:"使用门槛：",prop:"expire","label-width":"150px"}},[[o("el-radio-group",{model:{value:e.expire,callback:function(t){e.expire=t},expression:"expire"}},[o("el-radio",{attrs:{label:"1"}},[e._v("无限制")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("\n              满  \n              "),o("el-input",{staticStyle:{"margin-top":"-12px"},nativeOn:{keyup:function(t){return e.inputChange(e.couponPassForm.discountBase,"discountBase")}},model:{value:e.couponPassForm.discountBase,callback:function(t){e.$set(e.couponPassForm,"discountBase",t)},expression:"couponPassForm.discountBase"}},[o("template",{slot:"append"},[e._v("元")])],2)],1)],1)]],2),e._v(" "),o("el-form-item",{attrs:{label:"卷有效期：",prop:"expirePeriod","label-width":"150px"}},[o("el-radio-group",{model:{value:e.couponPassForm.expirePeriod,callback:function(t){e.$set(e.couponPassForm,"expirePeriod",t)},expression:"couponPassForm.expirePeriod"}},[o("el-radio",{attrs:{label:"2"}},[e._v("日期范围")]),e._v(" "),o("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.couponPassForm.expireArr,callback:function(t){e.$set(e.couponPassForm,"expireArr",t)},expression:"couponPassForm.expireArr"}}),e._v(" "),o("el-radio",{attrs:{label:"1"}},[e._v("固定天数")]),e._v(" "),o("el-input",{nativeOn:{keyup:function(t){return e.inputChange(e.couponPassForm.expireGap,"expireGap")}},model:{value:e.couponPassForm.expireGap,callback:function(t){e.$set(e.couponPassForm,"expireGap",t)},expression:"couponPassForm.expireGap"}},[o("template",{slot:"append"},[e._v("天")])],2)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"是否可与其他优惠同享：",prop:"oldPassword","label-width":"180px"}},[o("el-radio-group",{model:{value:e.available,callback:function(t){e.available=t},expression:"available"}},[o("el-radio",{attrs:{label:"1"}},[e._v("不可同时使用")])],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"可使用商品：",prop:"useType","label-width":"150px"}},[o("el-radio-group",{model:{value:e.couponPassForm.useType,callback:function(t){e.$set(e.couponPassForm,"useType",t)},expression:"couponPassForm.useType"}},[o("el-radio",{attrs:{label:"1"}},[e._v("全场通用")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("指定商品")]),e._v(" "),o("el-radio",{attrs:{label:"3"}},[e._v("指定分类")])],1)],1),e._v(" "),"2"==e.couponPassForm.useType?o("el-form-item",{attrs:{label:"添加商品：",prop:"oldPassword","label-width":"150px"}},[o("div",{staticClass:"store-choose"},[o("el-input",{staticClass:"input-with-select",staticStyle:{width:"300px"},attrs:{placeholder:"请输入内容"},model:{value:e.conditionForm.condition.name,callback:function(t){e.$set(e.conditionForm.condition,"name","string"==typeof t?t.trim():t)},expression:"conditionForm.condition.name"}},[o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.getItems(2)}},slot:"append"})],1),e._v(" "),o("el-table",{ref:"multipleStorItems",staticStyle:{width:"100%"},attrs:{data:e.storItems,"row-key":"id","header-cell-style":{background:"#E8EAEE",height:"48px"}},on:{"selection-change":e.storeChange}},[o("el-table-column",{attrs:{align:"center",type:"selection",width:"55","reserve-selection":!0}}),e._v(" "),o("el-table-column",{attrs:{align:"center","min-width":"100",prop:"name",label:"商品名称"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","min-width":"120",prop:"sellStat",label:"销售状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.sellStat?o("span",[e._v("上架")]):e._e(),e._v(" "),2===t.row.sellStat?o("span",[e._v("下架")]):e._e()]}}],null,!1,2473661334)})],1),e._v(" "),o("el-pagination",{staticClass:"pagination",attrs:{"page-sizes":[15,30,50,100],"page-size":e.params.page.pageSize,"current-page":e.params.page.pageNum,layout:"total, sizes,prev, pager, next, jumper",total:e.params.page.total},on:{"size-change":function(t){return e.pageSize(t,2)},"current-change":function(t){return e.pageNo(t,2)}}})],1)]):e._e(),e._v(" "),"3"==e.couponPassForm.useType?o("el-form-item",{attrs:{label:"选择分类",prop:"oldPassword","label-width":"150px"}},[o("div",{staticClass:"store-choose"},[o("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.conditionForm.condition.type,callback:function(t){e.$set(e.conditionForm.condition,"type",t)},expression:"conditionForm.condition.type"}},e._l(e.commonTypes,function(e){return o("el-option",{key:e.id,attrs:{label:e.typeName,value:e.id}})}),1),e._v(" "),o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"}),e._v(" "),o("el-table",{ref:"typeStorItems",staticStyle:{width:"100%"},attrs:{"row-key":"id",data:e.commonTypes,"header-cell-style":{background:"#E8EAEE",height:"48px"}},on:{"selection-change":e.typeChange}},[o("el-table-column",{attrs:{align:"center",type:"selection",width:"55","reserve-selection":!0}}),e._v(" "),o("el-table-column",{attrs:{align:"center","min-width":"100",prop:"typeName",label:"分类名称"}})],1)],1)]):e._e(),e._v(" "),o("el-form-item",{attrs:{label:"备注：",prop:"oldPassword","label-width":"150px"}},[o("textarea",{directives:[{name:"model",rawName:"v-model",value:e.couponPassForm.intro,expression:"couponPassForm.intro"}],staticStyle:{width:"550px"},attrs:{cols:"30",rows:"5"},domProps:{value:e.couponPassForm.intro},on:{input:function(t){t.target.composing||e.$set(e.couponPassForm,"intro",t.target.value)}}})])],1),e._v(" "),o("div",{staticClass:"footer"},[o("el-button",{attrs:{type:"info"},on:{click:e.backList}},[e._v("返 回")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addSure()}}},[e._v("确 定")])],1)],1)])},a=[],r={render:s,staticRenderFns:a};t.a=r},fZjL:function(e,t,o){e.exports={default:o("jFbC"),__esModule:!0}},fiCb:function(e,t,o){var s=o("/dkg");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);o("rjj0")("60e996fc",s,!0,{})},jFbC:function(e,t,o){o("Cdx3"),e.exports=o("FeBl").Object.keys},uqUo:function(e,t,o){var s=o("kM2E"),a=o("FeBl"),r=o("S82l");e.exports=function(e,t){var o=(a.Object||{})[e]||Object[e],i={};i[e]=t(o),s(s.S+s.F*r(function(){o(1)}),"Object",i)}},vDKy:function(e,t,o){"use strict";function s(e){o("fiCb")}Object.defineProperty(t,"__esModule",{value:!0});var a=o("2ZdO"),r=o("cU57"),i=o("VU/8"),n=s,l=i(a.a,r.a,!1,n,"data-v-ee488746",null);t.default=l.exports}});