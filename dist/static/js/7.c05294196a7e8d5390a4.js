webpackJsonp([7],{"1rHw":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"image-upload"},[e._l(e.previewImages,function(t,r){return a("div",{key:r,staticClass:"imgHeader"},["info"===e.pageAction?a("i",{staticClass:"ifont"}):e._e(),e._v(" "),"edit"===e.pageAction?a("i",{staticClass:"el-icon-close ifont",on:{click:function(t){return e.detailImg(r)}}}):e._e(),e._v(" "),a("img",{attrs:{src:t,alt:"未获取到图片",width:e.width,height:e.height},on:{click:function(t){return e.replaceImg(r)}}})])}),e._v(" "),e.previewImages.length<e.limit&&"viewImg"!==e.mode?a("label",{style:"width: "+e.width+"; height: "+e.height+";",attrs:{for:e.name+"uploader"}},[a("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "),a("input",{staticClass:"upfile",attrs:{accept:e.accept,multiple:e.multiple,type:"file",id:e.name+"uploader",hidden:""},on:{change:e.handleFileChange}})],2)},i=[],o={render:r,staticRenderFns:i};t.a=o},"56uO":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:"/store"}},[a("i",{staticClass:"fa fa-archive",attrs:{"aria-hidden":"true"}}),e._v("\n        我的店铺\n      ")]),e._v(" "),a("el-breadcrumb-item",[a("i",{staticClass:"fa fa-pencil-square-o",attrs:{"aria-hidden":"true"}}),e._v("\n        创建店铺\n      ")])],1)],1),e._v(" "),a("div",{staticClass:"content store-info"},[a("el-form",{ref:"itemForm",staticClass:"store-form",attrs:{model:e.itemForm,"label-width":"90px",rules:e.itemFormRules}},[a("el-form-item",{attrs:{label:"店铺名称",prop:"name"}},[a("el-input",{model:{value:e.itemForm.name,callback:function(t){e.$set(e.itemForm,"name","string"==typeof t?t.trim():t)},expression:"itemForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺地址",prop:"address"}},[a("el-input",{model:{value:e.itemForm.address,callback:function(t){e.$set(e.itemForm,"address","string"==typeof t?t.trim():t)},expression:"itemForm.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺图标",prop:"icon"}},[a("image-upload",{ref:"iconUploader",attrs:{name:"icon",externalPreviewImages:[],mode:"upload",limit:1,accept:"image/*",uploadUrl:e.$IMGHOST+"upload",success:e.setIcon,width:"100px",height:"100px"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺背景",prop:"index_html"}},[a("image-upload",{ref:"indexUploader",attrs:{name:"index",externalPreviewImages:[],mode:"upload",limit:1,accept:"image/*",uploadUrl:e.$IMGHOST+"upload",success:e.createStore,width:"100px",height:"100px"}})],1),e._v(" "),a("button",{staticClass:"lg-btn",attrs:{loading:e.saving},on:{click:e.saveItem}},[e._v("创建")])],1)],1)])},i=[],o={render:r,staticRenderFns:i};t.a=o},BO1k:function(e,t,a){e.exports={default:a("fxRn"),__esModule:!0}},D72X:function(e,t,a){var r=a("l+An");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("486b3b88",r,!0,{})},GV8p:function(e,t,a){"use strict";var r=a("mvHQ"),i=a.n(r),o=a("bnA/");t.a={components:{imageUpload:o.a},data:function(){return{itemForm:{id:-1,name:"",address:"",icon:"noimage",indexHtml:""},itemFormRules:{name:[{required:!0,message:"请输入店铺名称"}],address:[{required:!0,message:"请输入店铺的实际地址，可以写注册人的地址"}],icon:[{required:!0,message:"请选取图片"}]},saving:!1}},methods:{saveItem:function(){var e=this;this.$refs.itemForm.validate(function(t){return t?e.$refs.iconUploader.files.length?void e.$refs.iconUploader.upload():(e.$message.error("请选取图片"),!1):(e.$message.error("信息填写错误"),!1)})},setIcon:function(e){e.length&&(this.itemForm.icon=e[0]),this.$refs.indexUploader.upload()},createStore:function(e){var t=this;e.length&&(this.itemForm.indexHtml=e[0]),this.$http.ajax({url:APIHOST+"api/store/create",contentType:"application/json; charset=utf-8",type:"post",dataType:"json",data:i()(this.itemForm)}).done(function(e){1===e.result?(t.$message({message:"创建店铺成功",type:"success"}),t.$router.push("/store")):t.$message({message:"创建店铺失败",type:"error"})}).fail(function(){console.log("创建店铺接口出错")}).always(function(){t.saving=!1})}}}},H97s:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,".image-upload[data-v-1c5469a1]{display:-webkit-box}.image-upload img[data-v-1c5469a1]{margin-right:10px}.image-upload label[data-v-1c5469a1]{display:block;font-size:20px;color:#8c939d;line-height:100px;text-align:center;border:1.8px dashed #ccc;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.image-upload label[data-v-1c5469a1]:hover{border-color:#409eff}.imgHeader[data-v-1c5469a1]{position:relative}.ifont[data-v-1c5469a1]{position:absolute;right:0;top:7px;left:76px;color:#333;font-size:20px}",""])},J9PF:function(e,t,a){"use strict";function r(e){a("D72X")}Object.defineProperty(t,"__esModule",{value:!0});var i=a("GV8p"),o=a("56uO"),s=a("VU/8"),n=r,l=s(i.a,o.a,!1,n,"data-v-254d9a6b",null);t.default=l.exports},"bnA/":function(e,t,a){"use strict";function r(e){a("jeAz")}var i=a("irJt"),o=a("1rHw"),s=a("VU/8"),n=r,l=s(i.a,o.a,!1,n,"data-v-1c5469a1",null);t.a=l.exports},fxRn:function(e,t,a){a("+tPU"),a("zQR9"),e.exports=a("g8Ux")},g8Ux:function(e,t,a){var r=a("77Pl"),i=a("3fs2");e.exports=a("FeBl").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},irJt:function(e,t,a){"use strict";var r=a("BO1k"),i=a.n(r),o=a("//Fk"),s=a.n(o);t.a={props:["name","uploaderMode","externalPreviewImages","limit","accept","uploadUrl","success","width","height","pageAction2"],data:function(){return{files:[],previewImages:this.externalPreviewImages||[],replaceIndex:-1,uploadedCount:0,replacedImg:new Array(this.externalPreviewImages.length),uploadRes:[]}},computed:{mode:function(){return this.uploaderMode},pageAction:function(){var e=this.$route.path.split("/").pop();return"store"===e?this.pageAction2:e}},watch:{externalPreviewImages:function(){"upload"!==this.mode&&(this.previewImages=this.externalPreviewImages||[])}},methods:{addFile:function(e){var t=this;console.log(e),console.log(this.accept);var a=e.size/1024<200;if(this.accept&&!e.type.match(this.accept.split("/")[0]))throw Error("from imageUpload：“文件格式不正确”");new s.a(function(r,i){var o=new FormData;if(a)o.append("file",e),-1!==t.replaceIndex?(t.files.splice(t.replaceIndex,1,e),t.previewImages.splice(t.replaceIndex,1,window.URL.createObjectURL(e)),t.replacedImg[t.replaceIndex]=!0,t.replaceIndex=-1):t.files.length<t.limit&&(t.files.push(e),t.previewImages.push(window.URL.createObjectURL(e)));else{var s=t;t.photoCompress(e,{quality:.1},function(t){var r=s.convertBase64UrlToBlob(t);if(!(r.size/1024<200))return s.$message.error("上传图片大小不能超过 200KB!"),a;o.append("file",r),e=r,-1!==s.replaceIndex?(s.files.splice(s.replaceIndex,1,e),s.previewImages.splice(s.replaceIndex,1,window.URL.createObjectURL(e)),s.replacedImg[s.replaceIndex]=!0,s.replaceIndex=-1):s.files.length<s.limit&&(s.files.push(e),s.previewImages.push(window.URL.createObjectURL(e)))})}}),document.querySelectorAll(".upfile").forEach(function(e){e.value=""})},photoCompress:function(e,t,a){var r=new FileReader;r.readAsDataURL(e);var i=this;r.onload=function(){var e=this.result;i.canvasDataURL(e,t,a)}},canvasDataURL:function(e,t,a){var r=new Image;r.src=e,r.onload=function(){var e=this,r=.5,i=e.width,o=e.height,s=i/o;i=t.width||i,o=t.height||i/s,t.quality&&t.quality>0&&t.quality<=1&&(r=t.quality);var n=document.createElement("canvas"),l=n.getContext("2d"),c=document.createAttribute("width");c.nodeValue=i;var d=document.createAttribute("height");d.nodeValue=o,n.setAttributeNode(c),n.setAttributeNode(d),l.drawImage(e,0,0,i,o);var p=n.toDataURL("image/jpeg",r);a(p)}},convertBase64UrlToBlob:function(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],r=atob(t[1]),i=r.length,o=new Uint8Array(i);i--;)o[i]=r.charCodeAt(i);return new Blob([o],{type:a})},handleFileChange:function(e){var t=e.target.files,a=!0,r=!1,o=void 0;try{for(var s,n=i()(t);!(a=(s=n.next()).done);a=!0){var l=s.value;this.addFile(l)}}catch(e){r=!0,o=e}finally{try{!a&&n.return&&n.return()}finally{if(r)throw o}}},replaceImg:function(e){"viewImg"!==this.mode&&(this.replaceIndex=e,document.querySelector("#"+this.name+"uploader").click())},upload:function(){var e=this;if(console.log("uploaduploaduploaduploaduploaduploaduploaduploaduploaduploaduploadupload"),console.log(this.$GETIMGHOST),this.uploadedCount=0,this.uploadRes=new Array(this.files.length),!this.uploadUrl)throw new Error("from imageUpload：缺少uploadUrl");if(console.log(this.files),!this.files.length){var t=[];return void this.success(t)}for(var a=0;a<this.files.length;a++)!function(t){var a=e.files[t],r=new FileReader;r.onload=function(r){var i=new XMLHttpRequest;i.open("POST",e.uploadUrl),i.setRequestHeader("Content-type",a.type.split("/")[1]),i.onreadystatechange=function(){if(4===i.readyState)if(4===i.readyState&&200===i.status){var a=JSON.parse(i.responseText);if(a.ret?e.uploadRes[t]=a.info.md5:(e.uploadRes[t]="",e.$message.error("第"+(t+1)+"张图片上传失败："+a.error.message)),++e.uploadedCount===e.uploadRes.length){var r=new Array(e.replacedImg.length);if("replace"===e.mode){for(var o=0,s=0;o<e.replacedImg.length&&s<e.uploadRes.length;o++)e.replacedImg[o]?(r[o]=e.uploadRes[s],s++):r[o]="";s<e.uploadRes.length&&(r=r.concat(e.uploadRes.slice(s)))}else r=e.uploadRes;e.success(r)}}else if(200!==i.status&&304!==i.status)throw new Error("from imageUpload: 上传图片失败")},i.send(r.target.result)},r.readAsArrayBuffer(a)}(a)},detailImg:function(e){this.previewImages.splice(e,1)},reset:function(){this.files.splice(0),this.previewImages.splice(0),this.uploadRes.splice(0),this.uploadedCount=0}}}},jeAz:function(e,t,a){var r=a("H97s");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("7fd4c021",r,!0,{})},"l+An":function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,".store-form[data-v-254d9a6b]{width:400px;margin:20px auto}.lg-btn[data-v-254d9a6b]{width:260px;height:35px;background:#ff780d;border:1px solid #ff780d;border-radius:6px;margin-top:30px;color:#fff}.store-info[data-v-254d9a6b]{background-color:#fff;padding:10px;margin:10px}",""])},mvHQ:function(e,t,a){e.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(e,t,a){var r=a("FeBl"),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}}});